language: c

# container-based infrastructure
sudo: false


#os:
#      - linux
addons:
  apt:
    packages:
      - valgrind
      - libsndfile1
      - libsndfile1-dev

env:
  matrix:
    - GW_FLOAT_TYPE=float  GWION_DOC_DIR="./doc" GWION_API_DIR="./api" GWION_TOK_DIR="./tok" GWION_TAG_DIR="./tag" GWION_PLUG_DIR="./plug"
    - GW_FLOAT_TYPE=double GWION_DOC_DIR="./doc" GWION_API_DIR="./api" GWION_TOK_DIR="./tok" GWION_TAG_DIR="./tag" GWION_PLUG_DIR="./plug"
#  - osx


#compiler:
#  - clang
#7  - gcc

#matrix:
#  fast_finish: true
#  allow_failures:
#  -  os: osx


before_script:
  - git clone https://github.com/sstephenson/bats.git
#  - pushd bats && ./install.sh ./bin && popd && 
  - export PATH=$PATH:bats/bin
  - wget http://ftp.gnu.org/gnu/bison/bison-3.0.4.tar.gz
  - tar -xzf bison-3.0.4.tar.gz
  - pushd bison-3.0.4 && ./configure && make && popd && export PATH=bison-3.0.4:PATH
  - git clone -b dev https://github.com/paulbatchelor/Soundpipe.git
  - if [ $TRAVIS_OS_NAME = "osx" ]; then bash util/osx_prepare.sh; else bash util/linux_prepare.sh; fi
  - export CFLAGS+=-ISoundpipe/h
  - mkdir -p "$GWION_DOC_DIR"
  - mkdir -p "$GWION_API_DIR"
  - mkdir -p "$GWION_TOK_DIR"
  - mkdir -p "$GWION_TAG_DIR"
  - mkdir -p "$GWION_PLUG_DIR"

#before_install:
#bats
#  - git clone https://github.com/sstephenson/bats.git
#  - pushd bats && sudo ./install.sh /usr/local && popd
#  - wget http://ftp.gnu.org/gnu/bison/bison-3.0.4.tar.gz
#  - tar -xzf bison-3.0.4.tar.gz
#  - pushd bison-3.0.4 && ./configure && make && sudo make install && popd
#  - git clone -b dev https://github.com/paulbatchelor/Soundpipe.git
#  - if [ $TRAVIS_OS_NAME = "osx" ]; then bash util/osx_prepare.sh; else bash util/linux_prepare.sh; fi
#  - mkdir -p "$GWION_DOC_DIR"
#  - mkdir -p "$GWION_API_DIR"
#  - mkdir -p "$GWION_TOK_DIR"
#  - mkdir -p "$GWION_TAG_DIR"
#  - mkdir -p "$GWION_PLUG_DIR"

#env:
#   matrix:
#    - GW_FLOAT_TYPE=float  GWION_DOC_DIR="./doc" GWION_API_DIR="./api" GWION_TOK_DIR="./tok" GWION_TAG_DIR="./tag" GWION_PLUG_DIR="./plug"
#    - GW_FLOAT_TYPE=double GWION_DOC_DIR="./doc" GWION_API_DIR="./api" GWION_TOK_DIR="./tok" GWION_TAG_DIR="./tag" GWION_PLUG_DIR="./plug"

script:
#  - cp Soundpipe/h/soundpipe.h include
  - make
  - sh util/test.sh
